/* VS Code Theme Variables with Fallbacks */
:root {
  --mlb-bg-primary: var(--vscode-editor-background, #1f2933);
  --mlb-bg-secondary: var(--vscode-sideBar-background, #f8fafc);
  --mlb-bg-tertiary: var(--vscode-input-background, #fff);
  --mlb-text-primary: var(--vscode-editor-foreground, #1f2933);
  --mlb-text-secondary: var(--vscode-descriptionForeground, #64748b);
  --mlb-text-muted: var(--vscode-disabledForeground, #94a3b8);
  --mlb-border: var(--vscode-panel-border, #e2e8f0);
  --mlb-accent: var(--vscode-button-background, #f0b45b);
  --mlb-accent-hover: var(--vscode-button-hoverBackground, #e0a040);
  --mlb-error: var(--vscode-errorForeground, #ef4444);
  --mlb-success: var(--vscode-testing-iconPassed, #22c55e);
  --mlb-block-bg: #fff3d6;
  --mlb-block-border: #f0b45b;
}

html,
body,
#root {
  margin: 0;
  padding: 0;
  height: 100%;
  font-family: var(--vscode-font-family, -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif);
  font-size: var(--vscode-font-size, 13px);
  background: var(--mlb-bg-secondary);
  color: var(--mlb-text-primary);
}

.app {
  display: flex;
  flex-direction: column;
  height: 100%;
}

/* Toolbar */
.toolbar {
  display: flex;
  align-items: center;
  gap: 12px;
  padding: 8px 12px;
  background: var(--mlb-bg-primary);
  color: var(--vscode-titleBar-activeForeground, #f5f7fa);
  border-bottom: 1px solid var(--mlb-border);
}

.toolbar-title {
  font-weight: 600;
}

.toolbar-actions {
  display: flex;
  align-items: center;
  gap: 4px;
}

.toolbar-actions button {
  padding: 6px 12px;
  background: var(--vscode-button-secondaryBackground, #3e4c59);
  color: var(--vscode-button-secondaryForeground, #f5f7fa);
  border: none;
  border-radius: 4px;
  cursor: pointer;
  font-size: 12px;
}

.toolbar-actions button:hover:not(:disabled) {
  background: var(--vscode-button-secondaryHoverBackground, #52606d);
}

.toolbar-actions button:disabled {
  opacity: 0.5;
  cursor: not-allowed;
}

.toolbar-separator {
  color: var(--mlb-text-muted);
  margin: 0 4px;
}

.toolbar-error {
  color: var(--mlb-error);
  margin-left: auto;
  font-size: 12px;
}

.toolbar-status {
  margin-left: auto;
  font-size: 12px;
  opacity: 0.8;
}

/* Main Layout */
.main {
  display: grid;
  height: 100%;
  transition: grid-template-columns 0.2s ease;
}

/* Panel Header */
.panel-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 12px;
}

.panel-header h3 {
  margin: 0;
  font-size: 14px;
  color: var(--mlb-text-primary);
}

.panel-toggle {
  padding: 4px 8px;
  background: var(--mlb-border);
  border: none;
  border-radius: 4px;
  cursor: pointer;
  font-size: 10px;
  color: var(--mlb-text-secondary);
}

.panel-toggle:hover {
  background: var(--mlb-accent);
  color: var(--mlb-text-primary);
}

/* Palette Styles */
.palette,
.order-list {
  padding: 12px;
  overflow: auto;
  border-right: 1px solid var(--mlb-border);
  background: var(--mlb-bg-secondary);
  transition: width 0.2s ease, padding 0.2s ease;
}

.palette.collapsed,
.order-list.collapsed {
  padding: 12px 8px;
  overflow: hidden;
}

.palette.collapsed .palette-search,
.palette.collapsed .palette-nav,
.palette.collapsed .palette-search-results,
.palette.collapsed .palette-back,
.order-list.collapsed .order-content {
  display: none;
}

.order-list {
  border-right: none;
  border-left: 1px solid var(--mlb-border);
}

/* Palette Search */
.palette-search {
  margin-bottom: 12px;
}

.palette-search input {
  width: 100%;
  padding: 8px 10px;
  border: 1px solid var(--mlb-border);
  border-radius: 6px;
  font-size: 13px;
  box-sizing: border-box;
  background: var(--mlb-bg-tertiary);
  color: var(--mlb-text-primary);
}

.palette-search input:focus {
  outline: none;
  border-color: var(--mlb-accent);
  box-shadow: 0 0 0 2px rgba(240, 180, 91, 0.2);
}

.palette-search-results {
  margin-bottom: 12px;
}

.palette-search-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  font-size: 12px;
  color: var(--mlb-text-secondary);
  margin-bottom: 8px;
}

.palette-clear-search {
  background: none;
  border: none;
  color: var(--mlb-accent);
  cursor: pointer;
  font-size: 12px;
}

.palette-no-results {
  font-size: 13px;
  color: var(--mlb-text-muted);
  text-align: center;
  padding: 12px;
}

.palette-search-result {
  display: flex;
  flex-direction: column;
  width: 100%;
  padding: 8px;
  margin-bottom: 4px;
  background: var(--mlb-bg-tertiary);
  border: 1px solid var(--mlb-border);
  border-radius: 6px;
  text-align: left;
  cursor: pointer;
}

.palette-search-result:hover {
  border-color: var(--mlb-accent);
  background: #fffbf0;
}

.palette-search-result .block-name {
  font-weight: 500;
  color: var(--mlb-text-primary);
}

.palette-search-result .block-path {
  font-size: 11px;
  color: var(--mlb-text-muted);
  margin-top: 2px;
}

/* Palette Navigation */
.palette-back {
  display: block;
  width: 100%;
  padding: 8px;
  margin-bottom: 12px;
  background: var(--mlb-border);
  border: none;
  border-radius: 6px;
  font-size: 13px;
  cursor: pointer;
  text-align: left;
  color: var(--mlb-text-primary);
}

.palette-back:hover {
  background: var(--mlb-accent);
}

.palette-nav-title {
  font-weight: 600;
  font-size: 13px;
  color: var(--mlb-text-primary);
  margin-bottom: 8px;
  padding-bottom: 8px;
  border-bottom: 1px solid var(--mlb-border);
}

.palette-nav-items {
  display: flex;
  flex-direction: column;
  gap: 4px;
}

.palette-nav-item {
  display: flex;
  align-items: center;
  justify-content: space-between;
  width: 100%;
  padding: 10px 12px;
  background: var(--mlb-bg-tertiary);
  border: 1px solid var(--mlb-border);
  border-radius: 6px;
  font-size: 13px;
  cursor: pointer;
  text-align: left;
  transition: all 0.15s ease;
  color: var(--mlb-text-primary);
}

.palette-nav-item:hover {
  border-color: var(--mlb-accent);
  background: #fffbf0;
}

.palette-nav-arrow {
  color: var(--mlb-text-muted);
}

.palette-nav-count {
  font-size: 11px;
  color: var(--mlb-text-muted);
  margin-left: auto;
  margin-right: 8px;
}

/* Palette Blocks */
.palette-blocks {
  display: flex;
  flex-direction: column;
  gap: 4px;
}

.palette-block {
  display: flex;
  flex-direction: column;
  width: 100%;
  padding: 10px 12px;
  background: var(--mlb-block-bg);
  border: 1px solid var(--mlb-block-border);
  border-radius: 6px;
  text-align: left;
  cursor: grab;
  transition: all 0.15s ease;
}

.palette-block:hover {
  background: #ffecb3;
  transform: translateY(-1px);
  box-shadow: 0 2px 8px rgba(240, 180, 91, 0.3);
}

.palette-block.focused {
  border-width: 2px;
  box-shadow: 0 0 0 3px rgba(240, 180, 91, 0.3);
}

.palette-block:active {
  cursor: grabbing;
}

.palette-block .block-name {
  font-weight: 500;
  font-size: 13px;
  color: var(--mlb-text-primary);
}

.palette-block .block-output {
  font-size: 11px;
  color: var(--mlb-text-secondary);
  margin-top: 2px;
}

/* Canvas */
.canvas {
  height: 100%;
  position: relative;
  background: var(--vscode-editor-background, #f8fafc);
}

/* Block Node */
.block-node {
  background: var(--mlb-block-bg);
  border: 2px solid var(--mlb-block-border);
  border-radius: 8px;
  padding: 10px;
  min-width: 300px;
  font-size: 12px;
  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
}

.block-node.collapsed {
  min-width: 200px;
}

.block-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  gap: 8px;
  cursor: grab;
}

.block-header:active {
  cursor: grabbing;
}

.block-title {
  flex: 1;
  font-weight: 600;
  font-size: 13px;
  padding: 4px 6px;
  border: 1px solid transparent;
  border-radius: 4px;
  background: transparent;
  color: var(--mlb-text-primary);
  cursor: text;
}

.block-title:focus {
  border-color: var(--mlb-accent);
  background: var(--mlb-bg-tertiary);
  outline: none;
}

.block-actions {
  display: flex;
  gap: 4px;
}

.block-actions button {
  padding: 4px 8px;
  font-size: 11px;
  background: var(--mlb-accent);
  border: none;
  border-radius: 4px;
  cursor: pointer;
  color: var(--mlb-text-primary);
}

.block-actions button:hover {
  background: var(--mlb-accent-hover);
}

.block-badge {
  display: flex;
  align-items: center;
  gap: 8px;
  margin-top: 8px;
  padding: 6px 8px;
  background: rgba(255, 255, 255, 0.6);
  border-radius: 4px;
}

.block-badge label {
  font-weight: 500;
  font-size: 11px;
  color: var(--mlb-text-secondary);
}

.block-badge input {
  flex: 1;
  padding: 4px 6px;
  font-size: 12px;
  border: 1px solid var(--mlb-border);
  border-radius: 4px;
  background: var(--mlb-bg-tertiary);
  color: var(--mlb-text-primary);
}

.block-badge input:focus {
  border-color: var(--mlb-accent);
  outline: none;
}

.block-editor {
  margin-top: 8px;
  border: 1px solid var(--mlb-border);
  border-radius: 4px;
  overflow: hidden;
}

/* Block Output (per-block terminal) */
.block-output-section {
  margin-top: 8px;
  border: 1px solid var(--mlb-border);
  border-radius: 4px;
  overflow: hidden;
}

.block-output-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 4px 8px;
  background: var(--mlb-border);
}

.output-toggle {
  background: none;
  border: none;
  font-size: 11px;
  cursor: pointer;
  color: var(--mlb-text-primary);
  padding: 2px 4px;
}

.output-toggle:hover {
  color: var(--mlb-accent);
}

.output-clear {
  background: none;
  border: none;
  font-size: 10px;
  cursor: pointer;
  color: var(--mlb-text-muted);
  padding: 2px 6px;
}

.output-clear:hover {
  color: var(--mlb-error);
}

.block-output-panel {
  padding: 8px;
  background: var(--vscode-terminal-background, #1e1e1e);
  max-height: 150px;
  overflow: auto;
}

.block-output-panel pre {
  margin: 0;
  font-family: var(--vscode-editor-font-family, monospace);
  font-size: 11px;
  color: var(--vscode-terminal-foreground, #d4d4d4);
  white-space: pre-wrap;
  word-break: break-all;
}

.block-output-panel .output-error {
  color: var(--mlb-error);
}

.block-output-panel .output-image {
  max-width: 100%;
  border-radius: 4px;
  margin-top: 8px;
}

/* Colored Handles (Ports) */
.react-flow__handle {
  width: 10px !important;
  height: 10px !important;
  border-width: 1px !important;
}

/* Input handle - Green */
.handle-input,
.react-flow__handle-left {
  background: var(--mlb-success) !important;
  border-color: #16a34a !important;
}

/* Output handle - Red */
.handle-output,
.react-flow__handle-right {
  background: var(--mlb-error) !important;
  border-color: #dc2626 !important;
}

/* Order List */
.order-list h3 {
  margin: 0;
  font-size: 14px;
}

.order-content {
  margin-top: 8px;
}

.order-empty {
  color: var(--mlb-text-muted);
  font-size: 12px;
  text-align: center;
  padding: 12px;
}

.order-item {
  display: flex;
  align-items: center;
  gap: 8px;
  padding: 8px 10px;
  margin-bottom: 4px;
  background: var(--mlb-bg-tertiary);
  border: 1px solid var(--mlb-border);
  border-radius: 4px;
  font-size: 12px;
}

.order-index {
  font-weight: 600;
  color: var(--mlb-text-secondary);
  min-width: 20px;
}

.order-title {
  flex: 1;
  color: var(--mlb-text-primary);
}

.order-output {
  font-size: 10px;
  color: var(--mlb-text-muted);
  background: var(--mlb-border);
  padding: 2px 6px;
  border-radius: 4px;
}

/* Context Menu */
.context-menu {
  background: var(--vscode-menu-background, #fff);
  border: 1px solid var(--vscode-menu-border, #e2e8f0);
  border-radius: 8px;
  box-shadow: 0 4px 16px rgba(0, 0, 0, 0.15);
  padding: 4px;
  min-width: 160px;
}

.context-menu button {
  display: block;
  width: 100%;
  padding: 8px 12px;
  background: none;
  border: none;
  border-radius: 4px;
  font-size: 13px;
  text-align: left;
  cursor: pointer;
  color: var(--vscode-menu-foreground, var(--mlb-text-primary));
}

.context-menu button:hover:not(:disabled) {
  background: var(--vscode-menu-selectionBackground, #f1f5f9);
}

.context-menu button:disabled {
  color: var(--mlb-text-muted);
  cursor: not-allowed;
}

.context-menu hr {
  border: none;
  border-top: 1px solid var(--mlb-border);
  margin: 4px 0;
}

/* Drag Preview */
.drag-preview,
.drag-preview-live {
  padding: 8px 12px;
  background: var(--mlb-block-bg);
  border: 2px solid var(--mlb-block-border);
  border-radius: 6px;
  font-size: 12px;
  font-weight: 600;
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
  pointer-events: none;
  white-space: nowrap;
}

.drag-overlay {
  pointer-events: none;
}

/* Loading */
.loading {
  padding: 24px;
  text-align: center;
  color: var(--mlb-text-secondary);
}

/* React Flow overrides */
.react-flow__edge-path {
  stroke-width: 3px !important;
}

.react-flow__edge.selected .react-flow__edge-path {
  stroke: #f59e0b !important;
  stroke-width: 4px !important;
}

.react-flow__background {
  background: var(--vscode-editor-background, #f8fafc) !important;
}

/* MiniMap */
.react-flow__minimap {
  background: var(--mlb-bg-secondary) !important;
  border: 1px solid var(--mlb-border) !important;
  border-radius: 8px;
}

/* Scrollbar styling */
::-webkit-scrollbar {
  width: 8px;
  height: 8px;
}

::-webkit-scrollbar-track {
  background: transparent;
}

::-webkit-scrollbar-thumb {
  background: var(--mlb-border);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb:hover {
  background: var(--mlb-text-muted);
}
